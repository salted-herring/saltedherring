SVG.Element=function(e){this._stroke=SVG.defaults.attrs.stroke,this.styles={},this.trans=SVG.defaults.trans();if(this.node=e)this.type=e.nodeName,this.node.instance=this},SVG.extend(SVG.Element,{x:function(e){return e&&(e=new SVG.Number(e),e.value/=this.trans.scaleX),this.attr("x",e)},y:function(e){return e&&(e=new SVG.Number(e),e.value/=this.trans.scaleY),this.attr("y",e)},cx:function(e){return e==null?this.bbox().cx:this.x(e-this.bbox().width/2)},cy:function(e){return e==null?this.bbox().cy:this.y(e-this.bbox().height/2)},move:function(e,t){return this.x(e).y(t)},center:function(e,t){return this.cx(e).cy(t)},size:function(e,t){return this.attr({width:new SVG.Number(e),height:new SVG.Number(t)})},clone:function(){var e,t,n=this.type;return e=n=="rect"||n=="ellipse"?this.parent[n](0,0):n=="line"?this.parent[n](0,0,0,0):n=="image"?this.parent[n](this.src):n=="text"?this.parent[n](this.content):n=="path"?this.parent[n](this.attr("d")):n=="polyline"||n=="polygon"?this.parent[n](this.attr("points")):n=="g"?this.parent.group():this.parent[n](),t=this.attr(),delete t.id,e.attr(t),e.trans=this.trans,e.transform({})},remove:function(){return this.parent&&this.parent.removeElement(this),this},doc:function(e){return this._parent(e||SVG.Doc)},attr:function(e,t,n){if(e==null){e={},t=this.node.attributes;for(n=t.length-1;n>=0;n--)e[t[n].nodeName]=SVG.regex.test(t[n].nodeValue,"isNumber")?parseFloat(t[n].nodeValue):t[n].nodeValue;return e}if(typeof e=="object")for(t in e)this.attr(t,e[t]);else if(t===null)this.node.removeAttribute(e);else{if(t==null)return this._isStyle(e)?e=="text"?this.content:e=="leading"&&this.leading?this.leading():this.style(e):(t=this.node.getAttribute(e),t==null?SVG.defaults.attrs[e]:SVG.regex.test(t,"isNumber")?parseFloat(t):t);if(e=="style")return this.style(t);if(e=="x"&&Array.isArray(this.lines))for(n=this.lines.length-1;n>=0;n--)this.lines[n].attr(e,t);e=="stroke-width"?this.attr("stroke",parseFloat(t)>0?this._stroke:null):e=="stroke"&&(this._stroke=t),SVG.Color.test(t)||SVG.Color.isRgb(t)?t=new SVG.Color(t):typeof t=="number"?t=new SVG.Number(t):Array.isArray(t)&&(t=new SVG.Array(t)),n!=null?this.node.setAttributeNS(n,e,t.toString()):this.node.setAttribute(e,t.toString()),this._isStyle(e)&&(e=="text"?this.text(t):e=="leading"&&this.leading?this.leading(t):this.style(e,t),this.rebuild&&this.rebuild(e,t))}return this},transform:function(e,t){if(arguments.length==0)return this.trans;if(typeof e=="string"){if(arguments.length<2)return this.trans[e];var n={};return n[e]=t,this.transform(n)}var n=[];e=this._parseMatrix(e);for(t in e)e[t]!=null&&(this.trans[t]=e[t]);return this.trans.matrix=this.trans.a+" "+this.trans.b+" "+this.trans.c+" "+this.trans.d+" "+this.trans.e+" "+this.trans.f,e=this.trans,e.matrix!=SVG.defaults.matrix&&n.push("matrix("+e.matrix+")"),e.rotation!=0&&n.push("rotate("+e.rotation+" "+(e.cx==null?this.bbox().cx:e.cx)+" "+(e.cy==null?this.bbox().cy:e.cy)+")"),(e.scaleX!=1||e.scaleY!=1)&&n.push("scale("+e.scaleX+" "+e.scaleY+")"),e.skewX!=0&&n.push("skewX("+e.skewX+")"),e.skewY!=0&&n.push("skewY("+e.skewY+")"),(e.x!=0||e.y!=0)&&n.push("translate("+new SVG.Number(e.x/e.scaleX)+" "+new SVG.Number(e.y/e.scaleY)+")"),this._offset&&this._offset.x!=0&&this._offset.y!=0&&n.push("translate("+ -this._offset.x+" "+ -this._offset.y+")"),n.length==0?this.node.removeAttribute("transform"):this.node.setAttribute("transform",n.join(" ")),this},style:function(e,t){if(arguments.length==0)return this.attr("style")||"";if(arguments.length<2)if(typeof e=="object")for(t in e)this.style(t,e[t]);else{if(!SVG.regex.isCss.test(e))return this.styles[e];e=e.split(";");for(var n=0;n<e.length;n++)t=e[n].split(":"),t.length==2&&this.style(t[0].replace(/\s+/g,""),t[1].replace(/^\s+/,"").replace(/\s+$/,""))}else t===null||SVG.regex.test(t,"isBlank")?delete this.styles[e]:this.styles[e]=t;e="";for(t in this.styles)e+=t+":"+this.styles[t]+";";return e==""?this.node.removeAttribute("style"):this.node.setAttribute("style",e),this},data:function(e,t,n){if(arguments.length<2)try{return JSON.parse(this.attr("data-"+e))}catch(r){return this.attr("data-"+e)}else this.attr("data-"+e,t===null?null:n===!0||typeof t=="string"||typeof t=="number"?t:JSON.stringify(t));return this},bbox:function(){return new SVG.BBox(this)},rbox:function(){return new SVG.RBox(this)},inside:function(e,t){var n=this.bbox();return e>n.x&&t>n.y&&e<n.x+n.width&&t<n.y+n.height},show:function(){return this.style("display","")},hide:function(){return this.style("display","none")},visible:function(){return this.style("display")!="none"},toString:function(){return this.attr("id")},_parent:function(e){var t=this;while(t!=null&&!(t instanceof e))t=t.parent;return t},_isStyle:function(e){return typeof e=="string"?SVG.regex.test(e,"isStyle"):!1},_parseMatrix:function(e){if(e.matrix){var t=e.matrix.replace(/\s/g,"").split(",");t.length==6&&(e.a=parseFloat(t[0]),e.b=parseFloat(t[1]),e.c=parseFloat(t[2]),e.d=parseFloat(t[3]),e.e=parseFloat(t[4]),e.f=parseFloat(t[5]))}return e}});