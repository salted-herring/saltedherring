/*
	--------------------------------
	Infinite Scroll
	--------------------------------
	+ https://github.com/paulirish/infinitescroll
	+ version 2.0b2.110713
	+ Copyright 2011 Paul Irish & Luke Shumard
	+ Licensed under the MIT license
	
	+ Documentation: http://infinite-scroll.com/
	
*/

(function(e,t,n){t.infinitescroll=function(e,n,r){this.element=t(r),this._create(e,n)},t.infinitescroll.defaults={loading:{finished:n,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"http://www.infinite-scroll.com/loading.gif",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:n},state:{isDuringAjax:!1,isInvalidPage:!1,isDestroyed:!1,isDone:!1,isPaused:!1,currPage:1},callback:n,debug:!1,behavior:n,binder:t(e),nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:!1,pathParse:n,dataType:"html",appendCallback:!0,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:n,path:n},t.infinitescroll.prototype={_binding:function(e){var t=this,r=t.options;if(!!r.behavior&&this["_binding_"+r.behavior]!==n){this["_binding_"+r.behavior].call(this);return}if(e!=="bind"&&e!=="unbind")return this._debug("Binding value  "+e+" not valid"),!1;e=="unbind"?this.options.binder.unbind("smartscroll.infscr."+t.options.infid):this.options.binder[e]("smartscroll.infscr."+t.options.infid,function(){t.scroll()}),this._debug("Binding",e)},_create:function(e,r){if(!this._validate(e))return!1;var i=this.options=t.extend(!0,{},t.infinitescroll.defaults,e),s=/(.*?\/\/).*?(\/.*)/,o=t(i.nextSelector).attr("href");i.contentSelector=i.contentSelector||this.element,i.loading.selector=i.loading.selector||i.contentSelector;if(!o){this._debug("Navigation selector not found");return}i.path=this._determinepath(o),i.loading.msg=t('<div id="infscr-loading"><img alt="Loading..." src="'+i.loading.img+'" /><div>'+i.loading.msgText+"</div></div>"),(new Image).src=i.loading.img,i.pixelsFromNavToBottom=t(document).height()-t(i.navSelector).offset().top,i.loading.start=i.loading.start||function(){t(i.navSelector).hide(),i.loading.msg.appendTo(i.loading.selector).show(i.loading.speed,function(){beginAjax(i)})},i.loading.finished=i.loading.finished||function(){i.loading.msg.fadeOut("normal")},i.callback=function(e,s){!!i.behavior&&e["_callback_"+i.behavior]!==n&&e["_callback_"+i.behavior].call(t(i.contentSelector)[0],s),r&&r.call(t(i.contentSelector)[0],s)},this._setup()},_debug:function(){if(this.options.debug)return e.console&&console.log.call(console,arguments)},_determinepath:function(e){var t=this.options;if(!t.behavior||this["_determinepath_"+t.behavior]===n){if(!t.pathParse){if(e.match(/^(.*?)\b2\b(.*?$)/))e=e.match(/^(.*?)\b2\b(.*?$)/).slice(1);else if(e.match(/^(.*?)2(.*?$)/)){if(e.match(/^(.*?page=)2(\/.*|$)/))return e=e.match(/^(.*?page=)2(\/.*|$)/).slice(1),e;e=e.match(/^(.*?)2(.*?$)/).slice(1)}else{if(e.match(/^(.*?page=)1(\/.*|$)/))return e=e.match(/^(.*?page=)1(\/.*|$)/).slice(1),e;this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com."),t.state.isInvalidPage=!0}return this._debug("determinePath",e),e}return this._debug("pathParse manual"),t.pathParse}this["_determinepath_"+t.behavior].call(this,e);return},_error:function(e){var t=this.options;if(!!t.behavior&&this["_error_"+t.behavior]!==n){this["_error_"+t.behavior].call(this,e);return}e!=="destroy"&&e!=="end"&&(e="unknown"),this._debug("Error",e),e=="end"&&this._showdonemsg(),t.state.isDone=!0,t.state.currPage=1,t.state.isPaused=!1,this._binding("unbind")},_loadcallback:function(r,i){var s=this.options,o=this.options.callback,u=s.state.isDone?"done":s.appendCallback?"append":"no-append",a;if(!!s.behavior&&this["_loadcallback_"+s.behavior]!==n){this["_loadcallback_"+s.behavior].call(this,r,i);return}switch(u){case"done":return this._showdonemsg(),!1;case"no-append":s.dataType=="html"&&(i="<div>"+i+"</div>",i=t(i).find(s.itemSelector));break;case"append":var f=r.children();if(f.length==0)return this._error("end");a=document.createDocumentFragment();while(r[0].firstChild)a.appendChild(r[0].firstChild);this._debug("contentSelector",t(s.contentSelector)[0]),t(s.contentSelector)[0].appendChild(a),i=f.get()}s.loading.finished.call(t(s.contentSelector)[0],s);if(s.animate){var l=t(e).scrollTop()+t("#infscr-loading").height()+s.extraScrollPx+"px";t("html,body").animate({scrollTop:l},800,function(){s.state.isDuringAjax=!1})}s.animate||(s.state.isDuringAjax=!1),o(this,i)},_nearbottom:function(){var r=this.options,i=0+t(document).height()-r.binder.scrollTop()-t(e).height();if(!r.behavior||this["_nearbottom_"+r.behavior]===n)return this._debug("math:",i,r.pixelsFromNavToBottom),i-r.bufferPx<r.pixelsFromNavToBottom;this["_nearbottom_"+r.behavior].call(this);return},_pausing:function(e){var t=this.options;if(!t.behavior||this["_pausing_"+t.behavior]===n){e!=="pause"&&e!=="resume"&&e!==null&&this._debug("Invalid argument. Toggling pause value instead"),e=!e||e!="pause"&&e!="resume"?"toggle":e;switch(e){case"pause":t.state.isPaused=!0;break;case"resume":t.state.isPaused=!1;break;case"toggle":t.state.isPaused=!t.state.isPaused}return this._debug("Paused",t.state.isPaused),!1}this["_pausing_"+t.behavior].call(this,e);return},_setup:function(){var e=this.options;if(!e.behavior||this["_setup_"+e.behavior]===n)return this._binding("bind"),!1;this["_setup_"+e.behavior].call(this);return},_showdonemsg:function(){var e=this.options;if(!!e.behavior&&this["_showdonemsg_"+e.behavior]!==n){this["_showdonemsg_"+e.behavior].call(this);return}e.loading.msg.find("img").hide().parent().find("div").html(e.loading.finishedMsg).animate({opacity:1},2e3,function(){t(this).parent().fadeOut("normal")}),e.errorCallback.call(t(e.contentSelector)[0],"done")},_validate:function(e){for(var n in e)return n.indexOf&&n.indexOf("Selector")>-1&&t(e[n]).length===0?(this._debug("Your "+n+" found no elements."),!1):!0},bind:function(){this._binding("bind")},destroy:function(){return this.options.state.isDestroyed=!0,this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},retrieve:function(e){var r=this,i=r.options,s=i.path,o,u,a,f,l,e=e||null,c=e?e:i.state.currPage;beginAjax=function(e){e.state.currPage++,r._debug("heading into ajax",s),o=t(e.contentSelector).is("table")?t("<tbody/>"):t("<div/>"),a=s.join(e.state.currPage),f=e.dataType=="html"||e.dataType=="json"?e.dataType:"html+callback",e.appendCallback&&e.dataType=="html"&&(f+="+callback");switch(f){case"html+callback":r._debug("Using HTML via .load() method"),o.load(a+" "+e.itemSelector,null,function(e){r._loadcallback(o,e)});break;case"html":case"json":r._debug("Using "+f.toUpperCase()+" via $.ajax() method"),t.ajax({url:a,dataType:e.dataType,complete:function(e,t){l=typeof e.isResolved!="undefined"?e.isResolved():t==="success"||t==="notmodified",l?r._loadcallback(o,e.responseText):r._error("end")}})}};if(!!i.behavior&&this["retrieve_"+i.behavior]!==n){this["retrieve_"+i.behavior].call(this,e);return}if(i.state.isDestroyed)return this._debug("Instance is destroyed"),!1;i.state.isDuringAjax=!0,i.loading.start.call(t(i.contentSelector)[0],i)},scroll:function(){var e=this.options,t=e.state;if(!!e.behavior&&this["scroll_"+e.behavior]!==n){this["scroll_"+e.behavior].call(this);return}if(t.isDuringAjax||t.isInvalidPage||t.isDone||t.isDestroyed||t.isPaused)return;if(!this._nearbottom())return;this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))}},t.fn.infinitescroll=function(e,n){var r=typeof e;switch(r){case"string":var i=Array.prototype.slice.call(arguments,1);this.each(function(){var n=t.data(this,"infinitescroll");if(!n)return!1;if(!t.isFunction(n[e])||e.charAt(0)==="_")return!1;n[e].apply(n,i)});break;case"object":this.each(function(){var r=t.data(this,"infinitescroll");r?r.update(e):t.data(this,"infinitescroll",new t.infinitescroll(e,n,this))})}return this};var r=t.event,i;r.special.smartscroll={setup:function(){t(this).bind("scroll",r.special.smartscroll.handler)},teardown:function(){t(this).unbind("scroll",r.special.smartscroll.handler)},handler:function(e,n){var r=this,s=arguments;e.type="smartscroll",i&&clearTimeout(i),i=setTimeout(function(){t.event.handle.apply(r,s)},n==="execAsap"?0:100)}},t.fn.smartscroll=function(e){return e?this.bind("smartscroll",e):this.trigger("smartscroll",["execAsap"])}})(window,jQuery);