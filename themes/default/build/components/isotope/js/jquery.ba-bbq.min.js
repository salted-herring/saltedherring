/*
 * jQuery BBQ: Back Button & Query Library - v1.2.1 - 2/17/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */

/*
 * jQuery hashchange event - v1.2 - 2/11/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */

(function(e,t){function n(e){return typeof e=="string"}function r(e){var t=l.call(arguments,1);return function(){return e.apply(this,t.concat(l.call(arguments)))}}function i(e){return e.replace(/^[^#]*#?(.*)$/,"$1")}function s(e){return e.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function o(r,i,s,o,u){var a,l,p,v,m;return o!==f?(p=s.match(r?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/),m=p[3]||"",u===2&&n(o)?l=o.replace(r?A:L,""):(v=d(p[2]),o=n(o)?d[r?x:S](o):o,l=u===2?o:u===1?e.extend({},o,v):e.extend({},v,o),l=h(l),r&&(l=l.replace(O,c))),a=p[1]+(r?"#":l||!p[1]?"?":"")+l+m):a=i(s!==f?s:t[N][C]),a}function u(e,t,r){return t===f||typeof t=="boolean"?(r=t,t=h[e?x:S]()):t=n(t)?t.replace(e?A:L,""):t,d(t,r)}function a(t,r,i,s){return!n(i)&&typeof i!="object"&&(s=i,i=r,r=f),this.each(function(){var n=e(this),o=r||b()[(this.nodeName||"").toLowerCase()]||"",u=o&&n.attr(o)||"";n.attr(o,h[t](u,i,s))})}var f,l=Array.prototype.slice,c=decodeURIComponent,h=e.param,p,d,v,m=e.bbq=e.bbq||{},g,y,b,w=e.event.special,E="hashchange",S="querystring",x="fragment",T="elemUrlAttr",N="location",C="href",k="src",L=/^.*\?|#.*$/g,A=/^.*\#/,O,M={};h[S]=r(o,0,s),h[x]=p=r(o,1,i),p.noEscape=function(t){t=t||"";var n=e.map(t.split(""),encodeURIComponent);O=new RegExp(n.join("|"),"g")},p.noEscape(",/"),e.deparam=d=function(t,n){var r={},i={"true":!0,"false":!1,"null":null};return e.each(t.replace(/\+/g," ").split("&"),function(t,s){var o=s.split("="),u=c(o[0]),a,l=r,h=0,p=u.split("]["),d=p.length-1;/\[/.test(p[0])&&/\]$/.test(p[d])?(p[d]=p[d].replace(/\]$/,""),p=p.shift().split("[").concat(p),d=p.length-1):d=0;if(o.length===2){a=c(o[1]),n&&(a=a&&!isNaN(a)?+a:a==="undefined"?f:i[a]!==f?i[a]:a);if(d)for(;h<=d;h++)u=p[h]===""?l.length:p[h],l=l[u]=h<d?l[u]||(p[h+1]&&isNaN(p[h+1])?{}:[]):a;else e.isArray(r[u])?r[u].push(a):r[u]!==f?r[u]=[r[u],a]:r[u]=a}else u&&(r[u]=n?f:"")}),r},d[S]=r(u,0),d[x]=v=r(u,1),e[T]||(e[T]=function(t){return e.extend(M,t)})({a:C,base:C,iframe:k,img:k,input:k,form:"action",link:C,script:k}),b=e[T],e.fn[S]=r(a,S),e.fn[x]=r(a,x),m.pushState=g=function(e,r){n(e)&&/^#/.test(e)&&r===f&&(r=2);var i=e!==f,s=p(t[N][C],i?e:{},i?r:2);t[N][C]=s+(/#/.test(s)?"":"#")},m.getState=y=function(e,t){return e===f||typeof e=="boolean"?v(e):v(t)[e]},m.removeState=function(t){var n={};t!==f&&(n=y(),e.each(e.isArray(t)?t:arguments,function(e,t){delete n[t]})),g(n,2)},w[E]=e.extend(w[E],{add:function(t){function n(e){var t=e[x]=p();e.getState=function(e,n){return e===f||typeof e=="boolean"?d(t,e):d(t,n)[e]},r.apply(this,arguments)}var r;if(e.isFunction(t))return r=t,n;r=t.handler,t.handler=n}})})(jQuery,this),function(e,t,n){function r(e){return e=e||t[o][a],e.replace(/^[^#]*#?(.*)$/,"$1")}var i,s=e.event.special,o="location",u="hashchange",a="href",f=e.browser,l=document.documentMode,c=f.msie&&(l===n||l<8),h="on"+u in t&&!c;e[u+"Delay"]=100,s[u]=e.extend(s[u],{setup:function(){if(h)return!1;e(i.start)},teardown:function(){if(h)return!1;e(i.stop)}}),i=function(){function n(){l=h=function(e){return e},c&&(f=e('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow,h=function(){return r(f.document[o][a])},l=function(e,t){if(e!==t){var n=f.document;n.open().close(),n[o].hash="#"+e}},l(r()))}var i={},s,f,l,h;return i.start=function(){if(s)return;var i=r();l||n(),function f(){var n=r(),c=h(i);n!==i?(l(i=n,c),e(t).trigger(u)):c!==i&&(t[o][a]=t[o][a].replace(/#.*/,"")+"#"+c),s=setTimeout(f,e[u+"Delay"])}()},i.stop=function(){f||(s&&clearTimeout(s),s=0)},i}()}(jQuery,this);